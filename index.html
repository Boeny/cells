<html>
<body>
<div id="app"></div>
<script>
function hasChanged(component, props) {
  if (component.props !== props) {
    return true;
  }
  const keys = Object.keys(props);
  let key, value;
  for (let i = 0; i < keys.length; i += 1) {
    key = keys[i];
    if (key === 'cached' || key === 'props') {
      continue;
    }
    currentValue = component.props[key];
    // if at least one property has changed
    if (
        props[key] !== currentValue ||
        currentValue instanceof Array &&
        props[key].length !== currentValue.length
    ) {
      return true;
    }
  }
  return false;
}

function createElement(component, props, render) {
  if (hasChanged(component, props)) {// rerender the result
    component.props = props;
    component.cached = render();
  }
}

/**
 * props: Cell = {width: number; height: number}
 * @returns string
 */
function cell(props) {
  createElement(this, props, () => '<div style="display: inline-block; background: linear-gradient(to left, #8a8a8a, white); width: '+props.width+'; height: '+props.height+'"></div>');
}

/**
 * props: {cells: Cell[]}
 * @returns string
 */
function cells(props) {
  createElement(this, props, () => {
    let result = '';
    for (let i = 0; i < props.cells.length; i += 1) {
      result += (new cell(props.cells[i])).cached;
    }
    return result;
  });
}

const state = {
  cells: [{width: 20, height: 20}]
};

document.addEventListener('DOMContentLoaded', () => {
  const root = document.getElementById('app');
  function render(props) {
    createElement(this, props, () => root.innerHTML = (new cells(props)).cached);
  }
  function main() {
    requestAnimationFrame(main);
    new render(state);
  }
  main();
});
</script>
</body>
</html>